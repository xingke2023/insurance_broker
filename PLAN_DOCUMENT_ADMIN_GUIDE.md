# è®¡åˆ’ä¹¦ç®¡ç†åå°ä½¿ç”¨æŒ‡å—

## åŠŸèƒ½æ¦‚è¿°

Django Admin åå°å·²é…ç½®å®Œæ•´çš„è®¡åˆ’ä¹¦ç®¡ç†åŠŸèƒ½ï¼Œæ”¯æŒæŸ¥çœ‹ã€æœç´¢ã€ç­›é€‰å’Œç®¡ç†æ‰€æœ‰ä¿å­˜çš„è®¡åˆ’ä¹¦æ–‡æ¡£ã€‚

## è®¿é—®åå°

### 1. ç™»å½•åœ°å€

```
http://localhost:8007/admin/
```

### 2. ç™»å½•å‡­è¯

- **ç”¨æˆ·å**: `admin`
- **å¯†ç **: `admin123`

## ä¸»è¦åŠŸèƒ½

### âœ… è®¡åˆ’ä¹¦åˆ—è¡¨ç®¡ç†

è®¿é—® `è®¡åˆ’ä¹¦æ–‡æ¡£` å¯ä»¥çœ‹åˆ°ï¼š

**åˆ—è¡¨æ˜¾ç¤ºå­—æ®µ**ï¼š
- ID
- æ–‡ä»¶å
- ä¸Šä¼ ç”¨æˆ·
- å—ä¿äººå§“å
- ä¿é™©å…¬å¸
- çŠ¶æ€ï¼ˆå·²ä¸Šä¼ /å¤„ç†ä¸­/å·²å®Œæˆ/å¤±è´¥ï¼‰
- å†…å®¹é¢„è§ˆï¼ˆå‰50å­—ç¬¦ï¼‰
- åˆ›å»ºæ—¶é—´

**åŠŸèƒ½ç‰¹æ€§**ï¼š
- ğŸ” **æœç´¢**ï¼šæ”¯æŒæœç´¢æ–‡ä»¶åã€å—ä¿äººå§“åã€ä¿é™©å…¬å¸ã€OCRå†…å®¹
- ğŸ—‚ï¸ **ç­›é€‰**ï¼šæŒ‰çŠ¶æ€ã€ä¿é™©å…¬å¸ã€åˆ›å»ºæ—¶é—´ç­›é€‰
- ğŸ“… **æ—¶é—´å±‚çº§**ï¼šæŒ‰å¹´/æœˆ/æ—¥æµè§ˆ
- â¬‡ï¸ **æ’åº**ï¼šé»˜è®¤æŒ‰åˆ›å»ºæ—¶é—´å€’åº

### âœ… è®¡åˆ’ä¹¦è¯¦æƒ…æŸ¥çœ‹

ç‚¹å‡»ä»»æ„è®¡åˆ’ä¹¦å¯ä»¥æŸ¥çœ‹å®Œæ•´ä¿¡æ¯ï¼Œåˆ†ä¸ºä»¥ä¸‹éƒ¨åˆ†ï¼š

#### 1. åŸºæœ¬ä¿¡æ¯
- ä¸Šä¼ ç”¨æˆ·
- æ–‡ä»¶å
- æ–‡ä»¶è·¯å¾„
- æ–‡ä»¶å¤§å°
- çŠ¶æ€
- é”™è¯¯ä¿¡æ¯

#### 2. å—ä¿äººä¿¡æ¯
- å—ä¿äººå§“å
- å—ä¿äººå¹´é¾„
- æ€§åˆ«

#### 3. ä¿é™©äº§å“ä¿¡æ¯
- ä¿é™©äº§å“
- ä¿é™©å…¬å¸

#### 4. ä¿è´¹ä¿¡æ¯
- å¹´ç¼´ä¿è´¹
- ç¼´è´¹å¹´æ•°
- æ€»ä¿è´¹
- ä¿é™©æœŸé™
- åŸºæœ¬ä¿é¢

#### 5. OCRè¯†åˆ«å†…å®¹ï¼ˆé»˜è®¤æŠ˜å ï¼‰
- æ˜¾ç¤ºå®Œæ•´çš„OCRè§£ææ–‡æœ¬å†…å®¹
- æ ¼å¼åŒ–æ˜¾ç¤ºï¼ˆä¿ç•™æ¢è¡Œå’Œç©ºæ ¼ï¼‰
- å¯æ»šåŠ¨æŸ¥çœ‹ï¼ˆæœ€å¤§é«˜åº¦500pxï¼‰
- æµ…ç°èƒŒæ™¯ï¼Œä¾¿äºé˜…è¯»

#### 6. æå–æ•°æ®ï¼ˆé»˜è®¤æŠ˜å ï¼‰
- JSONæ ¼å¼çš„é¢å¤–æ•°æ®
- åŒ…å«task_idã€result_dirç­‰å…ƒæ•°æ®

#### 7. æ—¶é—´ä¿¡æ¯
- åˆ›å»ºæ—¶é—´
- æ›´æ–°æ—¶é—´

## æ–°å¢åŠŸèƒ½è¯´æ˜

### 1. User ID æ”¯æŒ

**API ä¿®æ”¹**ï¼š
- ä¿å­˜APIç°åœ¨æ”¯æŒ `user_id` å­—æ®µ
- å‰ç«¯å¯ä»¥ä¼ é€’ç”¨æˆ·IDå…³è”æ–‡æ¡£

**è¯·æ±‚ç¤ºä¾‹**ï¼š
```json
{
  "file_name": "document.pdf",
  "ocr_content": "è¯†åˆ«å†…å®¹...",
  "task_id": "task_123",
  "result_dir": "/path/to/result",
  "user_id": 1
}
```

å¦‚æœæä¾›äº†æœ‰æ•ˆçš„ `user_id`ï¼Œæ–‡æ¡£ä¼šå…³è”åˆ°è¯¥ç”¨æˆ·ã€‚

### 2. åå°ç®¡ç†ç•Œé¢

**å·²é…ç½®ä¸‰ä¸ªæ¨¡å‹çš„ç®¡ç†**ï¼š

#### PlanDocumentï¼ˆè®¡åˆ’ä¹¦æ–‡æ¡£ï¼‰
- å®Œæ•´çš„å­—æ®µå±•ç¤º
- åˆ†ç»„æ˜¾ç¤ºï¼ˆ6ä¸ªfieldsetsï¼‰
- OCRå†…å®¹æ ¼å¼åŒ–æ˜¾ç¤º
- æœç´¢å’Œç­›é€‰åŠŸèƒ½

#### InsurancePolicyï¼ˆä¿é™©ç­–ç•¥ï¼‰
- åŸºæœ¬çš„ä¿å•ç®¡ç†
- åˆ—è¡¨ã€æœç´¢ã€ç­›é€‰

#### AnnualValueï¼ˆå¹´åº¦ä»·å€¼ï¼‰
- ä¿å•å¹´åº¦ä»·å€¼ç®¡ç†
- å…³è”åˆ°è®¡åˆ’ä¹¦æ–‡æ¡£

## ä½¿ç”¨æµç¨‹

### åœºæ™¯1ï¼šæŸ¥çœ‹æ‰€æœ‰è®¡åˆ’ä¹¦

1. ç™»å½•åå° http://localhost:8007/admin/
2. ç‚¹å‡» `è®¡åˆ’ä¹¦æ–‡æ¡£`
3. æŸ¥çœ‹åˆ—è¡¨ï¼Œå¯ä»¥çœ‹åˆ°æ‰€æœ‰ä¿å­˜çš„æ–‡æ¡£

### åœºæ™¯2ï¼šæœç´¢ç‰¹å®šè®¡åˆ’ä¹¦

1. è¿›å…¥è®¡åˆ’ä¹¦æ–‡æ¡£åˆ—è¡¨
2. åœ¨å³ä¸Šè§’æœç´¢æ¡†è¾“å…¥å…³é”®è¯
   - å¯æœç´¢ï¼šæ–‡ä»¶åã€å—ä¿äººå§“åã€ä¿é™©å…¬å¸ã€OCRå†…å®¹
3. ç‚¹å‡»"æœç´¢"

### åœºæ™¯3ï¼šæŸ¥çœ‹OCRè¯†åˆ«å†…å®¹

1. ç‚¹å‡»ä»»æ„è®¡åˆ’ä¹¦è¿›å…¥è¯¦æƒ…
2. æ‰¾åˆ° `OCRè¯†åˆ«å†…å®¹` éƒ¨åˆ†ï¼ˆé»˜è®¤æŠ˜å ï¼‰
3. ç‚¹å‡»å±•å¼€ï¼ŒæŸ¥çœ‹å®Œæ•´çš„è¯†åˆ«æ–‡æœ¬
4. å†…å®¹ä¼šä»¥æ ¼å¼åŒ–çš„æ–¹å¼æ˜¾ç¤ºï¼Œä¿ç•™åŸå§‹æ¢è¡Œ

### åœºæ™¯4ï¼šæŒ‰æ—¶é—´ç­›é€‰

1. ä½¿ç”¨æ—¥æœŸå±‚çº§å¯¼èˆªï¼ˆé¡µé¢é¡¶éƒ¨ï¼‰
2. æˆ–ä½¿ç”¨å³ä¾§ç­›é€‰å™¨é€‰æ‹©åˆ›å»ºæ—¶é—´èŒƒå›´

### åœºæ™¯5ï¼šæŒ‰çŠ¶æ€ç­›é€‰

1. åœ¨å³ä¾§ç­›é€‰å™¨é€‰æ‹©çŠ¶æ€ï¼š
   - å·²ä¸Šä¼ 
   - å¤„ç†ä¸­
   - å·²å®Œæˆ
   - å¤±è´¥
2. æŸ¥çœ‹ç‰¹å®šçŠ¶æ€çš„æ–‡æ¡£

## æ•°æ®åº“ç»“æ„

### plan_documents è¡¨

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | Integer | ä¸»é”® |
| user_id | ForeignKey | å…³è”ç”¨æˆ·ï¼ˆå¯é€‰ï¼‰ |
| file_name | String | æ–‡ä»¶å |
| file_path | File | æ–‡ä»¶è·¯å¾„ |
| file_size | Integer | æ–‡ä»¶å¤§å°ï¼ˆå­—èŠ‚ï¼‰ |
| **content** | Text | **OCRè¯†åˆ«çš„å®Œæ•´å†…å®¹** |
| insured_name | String | å—ä¿äººå§“å |
| insured_age | Integer | å—ä¿äººå¹´é¾„ |
| insured_gender | String | æ€§åˆ« |
| insurance_product | String | ä¿é™©äº§å“ |
| insurance_company | String | ä¿é™©å…¬å¸ |
| annual_premium | Decimal | å¹´ç¼´ä¿è´¹ |
| payment_years | Integer | ç¼´è´¹å¹´æ•° |
| total_premium | Decimal | æ€»ä¿è´¹ |
| insurance_period | String | ä¿é™©æœŸé™ |
| sum_assured | Decimal | åŸºæœ¬ä¿é¢ |
| extracted_data | JSON | æå–çš„å®Œæ•´æ•°æ® |
| status | String | çŠ¶æ€ |
| error_message | Text | é”™è¯¯ä¿¡æ¯ |
| created_at | DateTime | åˆ›å»ºæ—¶é—´ |
| updated_at | DateTime | æ›´æ–°æ—¶é—´ |

## æŠ€æœ¯å®ç°

### Admin é…ç½®æ–‡ä»¶

**ä½ç½®**: `/var/www/harry-insurance/api/admin.py`

**å…³é”®ç‰¹æ€§**ï¼š

1. **è‡ªå®šä¹‰åˆ—è¡¨æ˜¾ç¤º**
```python
list_display = ['id', 'file_name', 'user_display', 'insured_name',
                'insurance_company', 'status', 'content_preview', 'created_at']
```

2. **å†…å®¹é¢„è§ˆæ–¹æ³•**
```python
def content_preview(self, obj):
    """æ˜¾ç¤ºå‰50ä¸ªå­—ç¬¦"""
    if obj.content:
        preview = obj.content[:50] + '...' if len(obj.content) > 50 else obj.content
        return format_html('<span style="color: #666;">{}</span>', preview)
    return '-'
```

3. **å®Œæ•´å†…å®¹æ˜¾ç¤º**
```python
def content_display(self, obj):
    """æ ¼å¼åŒ–æ˜¾ç¤ºå®Œæ•´OCRå†…å®¹"""
    if obj.content:
        return format_html(
            '<pre style="white-space: pre-wrap; word-wrap: break-word; '
            'max-height: 500px; overflow-y: auto; background: #f5f5f5; '
            'padding: 10px; border-radius: 4px;">{}</pre>',
            obj.content
        )
    return '-'
```

4. **åˆ†ç»„å­—æ®µé›†**
```python
fieldsets = (
    ('åŸºæœ¬ä¿¡æ¯', {...}),
    ('å—ä¿äººä¿¡æ¯', {...}),
    ('ä¿é™©äº§å“ä¿¡æ¯', {...}),
    ('ä¿è´¹ä¿¡æ¯', {...}),
    ('OCRè¯†åˆ«å†…å®¹', {
        'fields': ('content_display',),
        'classes': ('collapse',)  # é»˜è®¤æŠ˜å 
    }),
    ...
)
```

## å‰ç«¯é›†æˆ

å‰ç«¯ä¿å­˜æ–‡æ¡£æ—¶ï¼Œå¯ä»¥ä¼ é€’ user_idï¼š

```javascript
const response = await fetch('/api/ocr/save/', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    file_name: uploadedFile?.name,
    ocr_content: fileContent,
    task_id: taskId,
    result_dir: resultDir,
    user_id: currentUserId  // æ·»åŠ ç”¨æˆ·ID
  })
});
```

## æƒé™è¯´æ˜

- åªæœ‰è¶…çº§ç”¨æˆ·ï¼ˆsuperuserï¼‰å¯ä»¥è®¿é—® Django Admin
- å½“å‰è¶…çº§ç”¨æˆ·è´¦å·ï¼š`admin` / `admin123`
- å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤åˆ›å»ºæ›´å¤šè¶…çº§ç”¨æˆ·ï¼š

```bash
python3 manage.py createsuperuser
```

## å¸¸è§æ“ä½œ

### æ‰¹é‡æ“ä½œ

åœ¨åˆ—è¡¨é¡µé€‰æ‹©å¤šä¸ªé¡¹ç›®åï¼Œå¯ä»¥æ‰§è¡Œï¼š
- æ‰¹é‡åˆ é™¤
- å…¶ä»–è‡ªå®šä¹‰æ‰¹é‡æ“ä½œï¼ˆå¦‚æœ‰é…ç½®ï¼‰

### å¯¼å‡ºæ•°æ®

å¯ä»¥ä½¿ç”¨ Django Admin çš„ç¬¬ä¸‰æ–¹æ‰©å±•ï¼ˆå¦‚ django-import-exportï¼‰æ¥å¯¼å‡ºæ•°æ®ä¸º Excel/CSVã€‚

### æ•°æ®ä¿®æ”¹

- å¯ä»¥ç›´æ¥åœ¨åå°ç¼–è¾‘æ‰€æœ‰å­—æ®µ
- `created_at` å’Œ `updated_at` å­—æ®µä¸ºåªè¯»
- `content_display` ä¸ºåªè¯»ï¼ˆç”¨äºæ˜¾ç¤ºï¼‰
- å®é™…çš„ `content` å­—æ®µå­˜å‚¨åœ¨æ•°æ®åº“ä¸­

## å®‰å…¨å»ºè®®

1. **ç”Ÿäº§ç¯å¢ƒ**ï¼š
   - ä¿®æ”¹é»˜è®¤çš„ admin å¯†ç 
   - ä½¿ç”¨å¼ºå¯†ç 
   - é™åˆ¶ admin è®¿é—®çš„IPåœ°å€

2. **å¤‡ä»½**ï¼š
   - å®šæœŸå¤‡ä»½æ•°æ®åº“
   - ä¿å­˜é‡è¦æ–‡æ¡£çš„å‰¯æœ¬

3. **æ—¥å¿—**ï¼š
   - å¯ç”¨ Django Admin çš„æ“ä½œæ—¥å¿—
   - ç›‘æ§å¼‚å¸¸è®¿é—®

## ç›¸å…³æ–‡ä»¶

- **Adminé…ç½®**: `/var/www/harry-insurance/api/admin.py`
- **æ¨¡å‹å®šä¹‰**: `/var/www/harry-insurance/api/models.py`
- **ä¿å­˜API**: `/var/www/harry-insurance/api/ocr_views.py`
- **URLé…ç½®**: `/var/www/harry-insurance/api/urls.py`

## æˆªå›¾è¯´æ˜

### åˆ—è¡¨é¡µé¢
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è®¡åˆ’ä¹¦æ–‡æ¡£                                  [+ å¢åŠ è®¡åˆ’ä¹¦æ–‡æ¡£]    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ç­›é€‰å™¨:                                                         â”‚
â”‚ â–¡ çŠ¶æ€                                                          â”‚
â”‚   - å·²ä¸Šä¼                                                       â”‚
â”‚   - å¤„ç†ä¸­                                                      â”‚
â”‚   - å·²å®Œæˆ                                                      â”‚
â”‚   - å¤±è´¥                                                        â”‚
â”‚ â–¡ ä¿é™©å…¬å¸                                                      â”‚
â”‚ â–¡ åˆ›å»ºæ—¶é—´                                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ID | æ–‡ä»¶å | ç”¨æˆ· | å—ä¿äºº | ä¿é™©å…¬å¸ | çŠ¶æ€ | å†…å®¹é¢„è§ˆ | æ—¶é—´ â”‚
â”‚  1 | xxx.pdf| admin| å¼ ä¸‰   | XXä¿é™©  | å·²å®Œæˆ| COMPLETED...| ... â”‚
â”‚  2 | yyy.pdf| -    | æå››   | YYä¿é™©  | å·²å®Œæˆ| MODELCHAT...| ... â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### è¯¦æƒ…é¡µé¢
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ›´æ”¹ è®¡åˆ’ä¹¦æ–‡æ¡£                                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ åŸºæœ¬ä¿¡æ¯ â–¼                                                      â”‚
â”‚   ä¸Šä¼ ç”¨æˆ·: admin                                               â”‚
â”‚   æ–‡ä»¶å: document.pdf                                          â”‚
â”‚   ...                                                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ OCRè¯†åˆ«å†…å®¹ â–¶ (ç‚¹å‡»å±•å¼€)                                        â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚ COMPLETED                                             â”‚   â”‚
â”‚   â”‚                                                       â”‚   â”‚
â”‚   â”‚ MODELCHAT POSITIONS                                   â”‚   â”‚
â”‚   â”‚ ...                                                   â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## æ›´æ–°æ—¥å¿—

### 2025-11-05

âœ… **æ–°å¢åŠŸèƒ½**:
1. åˆ›å»ºå®Œæ•´çš„ Django Admin é…ç½®
2. æ·»åŠ  PlanDocumentã€InsurancePolicyã€AnnualValue ç®¡ç†
3. å®ç° OCR å†…å®¹çš„æ ¼å¼åŒ–æ˜¾ç¤º
4. æ·»åŠ æœç´¢ã€ç­›é€‰ã€æ’åºåŠŸèƒ½
5. æ”¯æŒ user_id å­—æ®µä¿å­˜
6. åˆ›å»ºè¶…çº§ç”¨æˆ·è´¦å·
7. ç¼–å†™å®Œæ•´ä½¿ç”¨æ–‡æ¡£

---

**æç¤º**: ç°åœ¨å¯ä»¥è®¿é—® http://localhost:8007/admin/ æŸ¥çœ‹å’Œç®¡ç†æ‰€æœ‰è®¡åˆ’ä¹¦ï¼
