# PDF自定义矩形擦除功能说明

📅 **发布日期**: 2025-12-17
✨ **功能**: 自定义矩形擦除 - 精确擦除PDF指定页面的任意位置

---

## 🎯 功能概述

新增**自定义矩形擦除功能**，允许用户在PDF的任意页面、任意位置精确擦除内容。适用于：
- 移除水印、logo
- 擦除特定文字或图像
- 清除页面中的特定区域
- 批量处理多页相同位置的内容

---

## 🌟 功能特点

### 1. 灵活的区域配置
- ✅ **多区域支持**：可添加无限个自定义擦除区域
- ✅ **精确定位**：通过坐标(X, Y)精确指定擦除位置
- ✅ **自由尺寸**：自定义宽度和高度
- ✅ **跨页擦除**：支持对多个连续页面应用相同的擦除规则

### 2. 智能预览
- 🟣 **紫色标识**：预览中用紫色半透明区域显示擦除位置
- 📄 **实时更新**：调整参数立即在预览中显示效果
- 🔢 **页码显示**：每个区域显示应用的页码范围

### 3. 便捷管理
- ✅ **启用/禁用**：每个区域可独立开关
- 🗑️ **快速删除**：一键删除不需要的擦除区域
- 💾 **自动保存**：设置自动保存到浏览器，下次使用无需重新配置

---

## 📐 坐标系说明

```
(0,0) ←───────────────── X轴 →
  ↓ ┌────────────────────────┐
  │ │                        │
  │ │     PDF页面内容        │
Y │ │                        │
轴 │ │                        │
  │ │                        │
  ↓ │                        │
    │     (X, Y)             │
    │      ┌─────┐           │
    │      │擦除 │           │
    │      │区域 │           │
    │      └─────┘           │
    │                        │
    └────────────────────────┘
```

**关键点：**
- 坐标原点 `(0, 0)` 在页面**左上角**
- X轴向右递增
- Y轴向下递增
- 单位：像素（px）

---

## 🎨 使用步骤

### 第一步：上传PDF文件
在"上传PDF文件"区域选择要处理的PDF。

### 第二步：添加自定义擦除区域

1. **点击"添加新的擦除区域"按钮**

2. **配置区域参数**：
   - **起始页**：从第几页开始擦除（例如：1）
   - **结束页**：到第几页结束擦除（例如：10）
     - 如果起始页=结束页，仅擦除单页
     - 如果起始页<结束页，擦除该范围内所有页面的相同位置

   - **X坐标**：擦除区域左上角的水平位置（像素）
   - **Y坐标**：擦除区域左上角的垂直位置（像素）
   - **宽度**：擦除区域的宽度（像素）
   - **高度**：擦除区域的高度（像素）

3. **实时预览调整**：
   - 电脑端自动显示PDF预览
   - 切换页码查看不同页面的擦除效果
   - 紫色半透明区域显示将被擦除的位置

### 第三步：处理PDF
点击"移除页脚"按钮，系统将：
1. 应用所有启用的擦除区域
2. 生成处理后的PDF文件
3. 文件名：`原文件名_1.pdf`

---

## 💡 实用示例

### 示例1: 移除单页水印
**场景**：第1页右上角有水印（位置：X=400, Y=20, 大小：150×80）

**配置**：
```
自定义区域 1:
  ✅ 启用
  起始页: 1
  结束页: 1
  X坐标: 400
  Y坐标: 20
  宽度: 150
  高度: 80
```

### 示例2: 批量移除所有页面的页眉Logo
**场景**：每页左上角有公司Logo（位置：X=30, Y=10, 大小：100×50），共20页

**配置**：
```
自定义区域 1:
  ✅ 启用
  起始页: 1
  结束页: 20
  X坐标: 30
  Y坐标: 10
  宽度: 100
  高度: 50
```

### 示例3: 擦除多个区域
**场景**：
- 第1-5页右下角有二维码（X=450, Y=750, 100×100）
- 第3-8页中间有文字水印（X=200, Y=400, 200×50）

**配置**：
```
自定义区域 1 (二维码):
  ✅ 启用
  起始页: 1
  结束页: 5
  X坐标: 450
  Y坐标: 750
  宽度: 100
  高度: 100

自定义区域 2 (文字水印):
  ✅ 启用
  起始页: 3
  结束页: 8
  X坐标: 200
  Y坐标: 400
  宽度: 200
  高度: 50
```

---

## 🔍 如何确定坐标？

### 方法1: 使用预览功能（推荐）
1. 上传PDF后打开预览
2. 先设置一个大致的坐标（例如：X=100, Y=100）
3. 观察紫色区域的位置
4. 根据实际位置微调X、Y坐标
5. 反复调整直到紫色区域覆盖目标内容

### 方法2: 使用PDF阅读器测量
1. 用Adobe Acrobat或其他PDF工具打开文件
2. 使用测量工具查看目标区域的坐标
3. 记录坐标值并输入到系统中

### 方法3: 试错法
1. 从(0, 0)开始
2. 设置较小的宽高（如100×100）
3. 逐步增加X、Y值
4. 观察预览中紫色区域的移动
5. 定位到目标位置

---

## ⚙️ 技术说明

### 前端实现
- **文件**: `frontend/src/components/PDFFooterRemover.jsx`
- **数据结构**:
```javascript
{
  enabled: true,        // 是否启用
  pageStart: 1,         // 起始页码
  pageEnd: 10,          // 结束页码
  x: 100,               // X坐标
  y: 200,               // Y坐标
  width: 150,           // 宽度
  height: 80            // 高度
}
```
- **预览颜色**: `rgba(168, 85, 247, 0.2)` (紫色半透明)
- **存储**: localStorage自动保存

### 后端实现
- **文件**: `api/pdf_views.py`
- **处理逻辑**:
```python
# 遍历所有自定义矩形
for custom_rect in custom_rects:
    # 检查当前页是否在范围内
    if current_page >= pageStart and current_page <= pageEnd:
        # 创建白色矩形覆盖指定区域
        rect = fitz.Rect(x, y, x + width, y + height)
        page.draw_rect(rect, color=(1, 1, 1), fill=(1, 1, 1))
```

---

## 📊 与其他擦除功能的对比

| 功能 | 预设区域 | 自定义矩形 |
|------|---------|-----------|
| 页眉/页脚通栏 | ✅ | ❌ |
| 四个角落 | ✅ | ❌ |
| 任意位置 | ❌ | ✅ |
| 多区域同时擦除 | ✅ | ✅ |
| 跨页批量处理 | ✅ | ✅ |
| 精确坐标定位 | ❌ | ✅ |
| 自定义尺寸 | 部分支持 | ✅ |

**建议**：
- 标准的页眉/页脚 → 使用预设区域
- 页面特定位置的内容 → 使用自定义矩形
- 复杂情况 → 组合使用两种方式

---

## ❓ 常见问题

### Q1: 为什么预览中看不到紫色区域？
**A**: 检查以下几点：
1. 区域是否已启用（勾选复选框）
2. 当前查看的页码是否在起始页-结束页范围内
3. 坐标是否在页面范围内（X、Y不能超出页面边界）

### Q2: 擦除区域位置不准确怎么办？
**A**:
1. 使用预览功能实时调整
2. 微调X、Y坐标（每次增减10-20像素）
3. 切换到目标页面查看效果
4. 必要时增加宽度或高度以完全覆盖目标内容

### Q3: 可以添加多少个自定义区域？
**A**: 理论上无限制，但建议：
- 常规使用：3-5个区域
- 复杂情况：10个以内
- 过多区域可能影响处理速度

### Q4: 自定义区域会被保存吗？
**A**: 是的！所有设置自动保存到浏览器localStorage，下次打开页面时会自动恢复。

### Q5: 如何快速清除所有自定义区域？
**A**: 点击页面底部的"重置"按钮，将清除所有设置（包括自定义区域）。

---

## 🚀 未来计划

- [ ] 可视化拖拽：直接在预览中拖拽选择擦除区域
- [ ] 模板保存：保存常用的擦除配置为模板
- [ ] 智能识别：AI自动检测并建议擦除区域
- [ ] 批量导入：支持从Excel/CSV导入多个擦除规则

---

## 📞 技术支持

如遇问题，请提供：
1. 浏览器控制台日志（F12 → Console）
2. 后端日志：`/var/www/harry-insurance2/logs/django.err.log`
3. PDF文件特征（页数、尺寸）
4. 自定义区域的配置参数
5. 预览截图（如有）

---

## 🎉 总结

自定义矩形擦除功能提供了**最灵活、最精确**的PDF内容擦除方案：

✅ **无位置限制** - 页面任意位置都可擦除
✅ **批量处理** - 多页相同位置一次配置
✅ **多区域支持** - 同时擦除多个不同位置
✅ **实时预览** - 所见即所得
✅ **自动保存** - 配置记忆，方便复用

享受高效的PDF编辑体验！ 🚀
