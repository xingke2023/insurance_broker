# 计划书数据提取工具使用说明

## 功能概述

计划书数据提取工具是一个专门用于从保险计划书PDF中自动提取关键数据的功能模块。它利用AI技术实现智能识别，并提供可视化的数据确认和编辑功能。

## 核心功能

### 1. 文件上传
- 支持拖拽上传和点击选择
- 只支持PDF格式文件
- 文件大小限制：10MB

### 2. 实时提取进度显示
系统会实时显示数据提取的5个步骤：
1. ✅ 上传文件
2. ✅ 读取PDF内容
3. ✅ AI数据提取
4. ✅ 解析年度价值表
5. ✅ 完成

每个步骤都会显示对应的状态图标和提示信息。

### 3. 数据预览与编辑

提取完成后，系统会展示以下三大类信息：

#### 受保人信息
- 受保人姓名
- 年龄
- 性别

#### 保险产品信息
- 保险产品名称
- 保险公司
- 保险期限
- 基本保额

#### 保费缴纳情况
- 年缴保费
- 缴费年数
- 总保费

所有字段都支持在编辑模式下进行修改。

### 4. 年度价值表展示

如果PDF中包含年度价值表数据，系统会以表格形式展示：
- 保单年度终结
- 保证现金价值（保证金额）
- 非保证现金价值（非保证金额）
- 总现金价值（总额）

### 5. 数据确认与保存

- **查看模式**：查看提取的数据，确认无误后保存
- **编辑模式**：点击"编辑数据"按钮，修改任何字段
- **保存功能**：确认后将数据保存到系统数据库

## 数据库结构

### 主表：plan_documents
存储计划书的基本信息和提取的数据：
- 文件信息（文件名、大小、路径）
- 受保人信息
- 保险产品信息
- 保费缴纳情况
- 提取状态和完整JSON数据

### 明细表：annual_values
存储每个保单年度的价值数据：
- 关联的计划书ID
- 保单年度
- 保证现金价值
- 非保证现金价值
- 总现金价值

两表通过外键关联，支持一对多关系。

## API 端点

### 1. 上传计划书并提取数据
```
POST /api/plans/upload/
Content-Type: multipart/form-data

Body: { file: [PDF文件] }
```

### 2. 获取计划书列表
```
GET /api/plans/
```

### 3. 获取单个计划书详情
```
GET /api/plans/{id}/
```

### 4. 更新计划书数据
```
PUT /api/plans/{id}/update/
Content-Type: application/json

Body: {
  customer_name: "张三",
  customer_age: 35,
  customer_gender: "男",
  insurance_product: "终身寿险",
  insurance_company: "某某保险公司",
  insurance_period: "终身",
  insurance_amount: 1000000,
  premium_amount: 50000,
  payment_years: 20,
  total_premium: 1000000,
  annual_values: [
    {
      policy_year: 1,
      guaranteed_value: 10000,
      non_guaranteed_value: 5000,
      total_value: 15000
    },
    ...
  ]
}
```

## 使用流程

1. **访问页面**：导航到计划书提取工具页面
2. **上传文件**：拖拽或选择PDF文件
3. **等待提取**：观察实时进度，等待AI提取完成
4. **核对数据**：查看提取的所有字段，确认准确性
5. **编辑修正**：如有错误，点击"编辑数据"按钮进行修改
6. **保存数据**：点击"确认并保存到系统"按钮
7. **继续处理**：可以点击"提取新文件"继续处理下一份文档

## 技术特点

- ✅ 实时进度反馈，用户体验友好
- ✅ 支持数据在线编辑，灵活修正
- ✅ 结构化存储，便于后续查询和统计
- ✅ 年度价值表自动解析和展示
- ✅ 响应式设计，支持各种屏幕尺寸

## 注意事项

1. 确保上传的PDF文件清晰可读
2. 提取后务必核对数据准确性
3. 编辑后记得保存，否则修改会丢失
4. 年度价值表数据较多时注意滚动查看

## 未来扩展

- [ ] 支持批量上传和处理
- [ ] 添加数据导出功能（Excel、CSV）
- [ ] 支持自定义字段映射
- [ ] 添加数据对比和差异分析功能
- [ ] 集成OCR增强识别准确度
