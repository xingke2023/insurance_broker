# å¼€å§‹ä½¿ç”¨é˜¿é‡Œåƒé—®PDFè¯†åˆ«

## ğŸ¯ ç›®æ ‡

æœ¬æŒ‡å—å°†å¸®åŠ©æ‚¨åœ¨5åˆ†é’Ÿå†…å®Œæˆé˜¿é‡Œåƒé—®PDFè¯†åˆ«åŠŸèƒ½çš„é…ç½®å’Œæµ‹è¯•ã€‚

## ğŸ“‹ å‰ææ¡ä»¶

- âœ“ Python 3.8+ å·²å®‰è£…
- âœ“ é¡¹ç›®å·²å…‹éš†åˆ°æœ¬åœ°
- âœ“ é˜¿é‡Œäº‘è´¦å·ï¼ˆç”¨äºè·å–APIå¯†é’¥ï¼‰

## ğŸš€ 5åˆ†é’Ÿå¿«é€Ÿä¸Šæ‰‹

### ç¬¬1æ­¥ï¼šè·å–APIå¯†é’¥ï¼ˆ2åˆ†é’Ÿï¼‰

1. è®¿é—® [é˜¿é‡Œäº‘DashScopeæ§åˆ¶å°](https://dashscope.console.aliyun.com/)

2. ç™»å½•æˆ–æ³¨å†Œé˜¿é‡Œäº‘è´¦å·

3. å¼€é€šDashScopeæœåŠ¡ï¼ˆå…è´¹å¼€é€šï¼‰

4. åœ¨æ§åˆ¶å°åˆ›å»ºAPI Key

5. å¤åˆ¶APIå¯†é’¥ï¼ˆæ ¼å¼ï¼šsk-xxxxxxxxxxxxxxxxï¼‰

### ç¬¬2æ­¥ï¼šé…ç½®ç¯å¢ƒï¼ˆ1åˆ†é’Ÿï¼‰

åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º `.env` æ–‡ä»¶ï¼š

```bash
# å¤åˆ¶æ¨¡æ¿
cp .env.example .env

# ç¼–è¾‘æ–‡ä»¶
nano .env
```

æ·»åŠ æ‚¨çš„APIå¯†é’¥ï¼š

```bash
DASHSCOPE_API_KEY=sk-your-actual-api-key-here
```

ä¿å­˜å¹¶é€€å‡ºï¼ˆCtrl+X, Y, Enterï¼‰

### ç¬¬3æ­¥ï¼šå®‰è£…ä¾èµ–ï¼ˆ1åˆ†é’Ÿï¼‰

```bash
pip install openai pypdf
```

æˆ–ä½¿ç”¨å®Œæ•´çš„ä¾èµ–åˆ—è¡¨ï¼š

```bash
pip install -r requirements.txt
```

### ç¬¬4æ­¥ï¼šæµ‹è¯•é…ç½®ï¼ˆ1åˆ†é’Ÿï¼‰

è¿è¡Œæµ‹è¯•è„šæœ¬ï¼š

```bash
python test_qwen_api.py
```

**æœŸæœ›è¾“å‡ºï¼š**
```
==================================================
é˜¿é‡Œåƒé—®APIé…ç½®æµ‹è¯•
==================================================

==================================================
æ£€æŸ¥ç¯å¢ƒé…ç½®...
==================================================
âœ“ æ‰¾åˆ° DASHSCOPE_API_KEY
  å¯†é’¥å‰ç¼€ï¼šsk-xxxxxxxx...

==================================================
æµ‹è¯•åƒé—®æ–‡æœ¬æ¨¡å‹...
==================================================
âœ“ APIè°ƒç”¨æˆåŠŸï¼

æå–çš„æ•°æ®ï¼š
{
  "customer_name": "å¼ ä¸‰",
  "customer_age": 35,
  ...
}

==================================================
æµ‹è¯•æ€»ç»“
==================================================
âœ“ æ–‡æœ¬æ¨¡å‹æµ‹è¯•é€šè¿‡
âŠ˜ è§†è§‰æ¨¡å‹æµ‹è¯•å·²è·³è¿‡

âœ“ åŸºç¡€åŠŸèƒ½æ­£å¸¸ï¼Œå¯ä»¥å¼€å§‹ä½¿ç”¨ï¼
```

### ç¬¬5æ­¥ï¼šå¯åŠ¨æœåŠ¡ï¼ˆ30ç§’ï¼‰

```bash
python manage.py runserver
```

æœåŠ¡å°†åœ¨ `http://localhost:8007` å¯åŠ¨

## âœ… éªŒè¯å®‰è£…

### æµ‹è¯•APIç«¯ç‚¹

ä½¿ç”¨cURLæµ‹è¯•ä¸Šä¼ åŠŸèƒ½ï¼š

```bash
# å‡†å¤‡ä¸€ä¸ªæµ‹è¯•PDFæ–‡ä»¶
# ç„¶åæ‰§è¡Œï¼š
curl -X POST http://localhost:8007/api/plans/upload/ \
  -F "file=@your_insurance_plan.pdf"
```

**æˆåŠŸå“åº”ç¤ºä¾‹ï¼š**
```json
{
  "message": "æ–‡ä»¶ä¸Šä¼ å¹¶å¤„ç†æˆåŠŸ",
  "document_id": 1,
  "extracted_data": {
    "customer_name": "å¼ ä¸‰",
    "customer_age": 35,
    "customer_gender": "ç”·",
    "insurance_product": "å¹³å®‰ç¦ç»ˆèº«å¯¿é™©",
    "insurance_company": "ä¸­å›½å¹³å®‰",
    "insurance_amount": 500000,
    "premium_amount": 15000,
    "payment_years": 20,
    "total_premium": 300000,
    "insurance_period": "ç»ˆèº«"
  },
  "file_info": {
    "name": "ä¿é™©è®¡åˆ’ä¹¦.pdf",
    "size": 1048576,
    "status": "completed"
  }
}
```

## ğŸ“ åŸºæœ¬ä½¿ç”¨

### Pythonç¤ºä¾‹

```python
import requests

# ä¸Šä¼ PDFæ–‡ä»¶
with open('insurance_plan.pdf', 'rb') as f:
    files = {'file': f}
    response = requests.post(
        'http://localhost:8007/api/plans/upload/',
        files=files
    )

if response.status_code == 201:
    data = response.json()
    print("æå–æˆåŠŸï¼")
    print(f"å®¢æˆ·å§“åï¼š{data['extracted_data']['customer_name']}")
    print(f"ä¿é™©äº§å“ï¼š{data['extracted_data']['insurance_product']}")
    print(f"ä¿è´¹ï¼š{data['extracted_data']['premium_amount']}")
else:
    print(f"ä¸Šä¼ å¤±è´¥ï¼š{response.json()}")
```

### JavaScriptç¤ºä¾‹

```javascript
// åœ¨HTMLä¸­ä½¿ç”¨
<input type="file" id="pdfFile" accept=".pdf" />

<script>
document.getElementById('pdfFile').addEventListener('change', async (e) => {
  const file = e.target.files[0];
  const formData = new FormData();
  formData.append('file', file);

  try {
    const response = await fetch('http://localhost:8007/api/plans/upload/', {
      method: 'POST',
      body: formData
    });

    const data = await response.json();
    console.log('æå–çš„æ•°æ®ï¼š', data.extracted_data);
  } catch (error) {
    console.error('ä¸Šä¼ å¤±è´¥ï¼š', error);
  }
});
</script>
```

## ğŸ”§ å¸¸è§é—®é¢˜æ’æŸ¥

### é—®é¢˜1ï¼šAPIå¯†é’¥é”™è¯¯

**ç—‡çŠ¶ï¼š**
```
ValueError: DASHSCOPE_API_KEYç¯å¢ƒå˜é‡æœªè®¾ç½®
```

**è§£å†³æ–¹æ¡ˆï¼š**
1. æ£€æŸ¥ `.env` æ–‡ä»¶æ˜¯å¦å­˜åœ¨
2. ç¡®è®¤å¯†é’¥æ ¼å¼ï¼š`DASHSCOPE_API_KEY=sk-xxx`
3. é‡å¯DjangoæœåŠ¡

### é—®é¢˜2ï¼šæ¨¡å—æœªæ‰¾åˆ°

**ç—‡çŠ¶ï¼š**
```
ModuleNotFoundError: No module named 'openai'
```

**è§£å†³æ–¹æ¡ˆï¼š**
```bash
pip install openai pypdf
```

### é—®é¢˜3ï¼šæ–‡ä»¶ä¸Šä¼ å¤±è´¥

**ç—‡çŠ¶ï¼š**
```json
{"error": "åªæ”¯æŒPDFæ–‡ä»¶"}
```

**è§£å†³æ–¹æ¡ˆï¼š**
1. ç¡®è®¤æ–‡ä»¶æ‰©å±•åä¸º `.pdf`
2. æ£€æŸ¥æ–‡ä»¶å¤§å°ï¼ˆä¸è¶…è¿‡10MBï¼‰
3. ç¡®ä¿æ–‡ä»¶æœªæŸå

### é—®é¢˜4ï¼šè¯†åˆ«ç»“æœä¸å‡†ç¡®

**å¯èƒ½åŸå› ï¼š**
- PDFè´¨é‡è¾ƒå·®
- æ–‡æ¡£æ ¼å¼ä¸æ ‡å‡†
- å…³é”®ä¿¡æ¯ä½ç½®ä¸æ˜æ˜¾

**æ”¹è¿›æ–¹æ³•ï¼š**
1. ä½¿ç”¨é«˜è´¨é‡çš„åŸç”ŸPDFï¼ˆè€Œéæ‰«æç‰ˆï¼‰
2. ç¡®ä¿æ–‡å­—æ¸…æ™°å¯è¯»
3. ä½¿ç”¨æ ‡å‡†æ ¼å¼çš„ä¿é™©è®¡åˆ’ä¹¦

### é—®é¢˜5ï¼šç½‘ç»œè¿æ¥è¶…æ—¶

**ç—‡çŠ¶ï¼š**
```
APIè°ƒç”¨å¤±è´¥: Connection timeout
```

**è§£å†³æ–¹æ¡ˆï¼š**
1. æ£€æŸ¥ç½‘ç»œè¿æ¥
2. ç¡®è®¤å¯ä»¥è®¿é—® `dashscope.aliyuncs.com`
3. æ£€æŸ¥é˜²ç«å¢™è®¾ç½®

## ğŸ“š ä¸‹ä¸€æ­¥

### å­¦ä¹ æ›´å¤š

- **è¯¦ç»†é…ç½®**ï¼šé˜…è¯» [QWEN_SETUP.md](./QWEN_SETUP.md)
- **ä»£ç ç¤ºä¾‹**ï¼šæŸ¥çœ‹ [QWEN_USAGE_EXAMPLES.md](./QWEN_USAGE_EXAMPLES.md)
- **å¿«é€Ÿå‚è€ƒ**ï¼šæŸ¥çœ‹ [QWEN_QUICK_REFERENCE.md](./QWEN_QUICK_REFERENCE.md)
- **é¡¹ç›®ç»“æ„**ï¼šäº†è§£ [PROJECT_STRUCTURE.md](./PROJECT_STRUCTURE.md)

### é›†æˆåˆ°å‰ç«¯

å¦‚æœæ‚¨éœ€è¦åœ¨Reactå‰ç«¯ä¸­ä½¿ç”¨æ­¤åŠŸèƒ½ï¼Œè¯·å‚è€ƒï¼š

1. **Reactç»„ä»¶ç¤ºä¾‹**ï¼š[QWEN_USAGE_EXAMPLES.md](./QWEN_USAGE_EXAMPLES.md#react-ç»„ä»¶ç¤ºä¾‹)
2. **APIè°ƒç”¨å°è£…**ï¼šæŸ¥çœ‹ `frontend/src/services/api.js`

### ä¼˜åŒ–å’Œå®šåˆ¶

1. **è‡ªå®šä¹‰æå–å­—æ®µ**ï¼š
   - ç¼–è¾‘ `api/qwen_service.py`
   - ä¿®æ”¹ prompt æ·»åŠ æ–°å­—æ®µ

2. **æ‰¹é‡å¤„ç†**ï¼š
   - å‚è€ƒ [QWEN_USAGE_EXAMPLES.md](./QWEN_USAGE_EXAMPLES.md#æ‰¹é‡å¤„ç†)

3. **é”™è¯¯å¤„ç†**ï¼š
   - å®ç°é‡è¯•æœºåˆ¶
   - æ·»åŠ è¯¦ç»†æ—¥å¿—

## ğŸ’¡ ä½¿ç”¨å»ºè®®

### æœ€ä½³å®è·µ

1. **æ–‡ä»¶å‡†å¤‡**
   - ä½¿ç”¨åŸç”ŸPDFè€Œéæ‰«æç‰ˆ
   - ä¿æŒæ–‡ä»¶å¤§å°åœ¨5MBä»¥ä¸‹
   - ç¡®ä¿æ–‡å­—æ¸…æ™°å¯è¯»

2. **æˆæœ¬æ§åˆ¶**
   - ä¼˜å…ˆä½¿ç”¨æ–‡æœ¬æå–+åˆ†æï¼ˆæ›´ä¾¿å®œï¼‰
   - å®ç°ç»“æœç¼“å­˜
   - æ‰¹é‡å¤„ç†æ§åˆ¶å¹¶å‘

3. **å‡†ç¡®æ€§æå‡**
   - ä½¿ç”¨æ ‡å‡†æ ¼å¼æ–‡æ¡£
   - æä¾›äººå·¥æ ¡éªŒç•Œé¢
   - æ”¶é›†åé¦ˆä¼˜åŒ–prompt

### æ€§èƒ½ä¼˜åŒ–

1. **å“åº”æ—¶é—´**
   - å°æ–‡ä»¶ï¼š2-5ç§’
   - ä¸­æ–‡ä»¶ï¼š5-10ç§’
   - å¤§æ–‡ä»¶ï¼š10-20ç§’

2. **å¹¶å‘å¤„ç†**
   - å»ºè®®æ§åˆ¶åœ¨5ä¸ªå¹¶å‘ä»¥å†…
   - ä½¿ç”¨å¼‚æ­¥å¤„ç†é˜Ÿåˆ—

3. **é”™è¯¯é‡è¯•**
   - å®ç°æŒ‡æ•°é€€é¿
   - æœ€å¤šé‡è¯•3æ¬¡

## ğŸ‰ æˆåŠŸï¼

å¦‚æœæ‚¨å®Œæˆäº†ä»¥ä¸Šæ­¥éª¤ï¼Œæ‚¨ç°åœ¨å¯ä»¥ï¼š

âœ… ä¸Šä¼ PDFæ–‡ä»¶
âœ… è‡ªåŠ¨æå–ä¿é™©è®¡åˆ’ä¹¦æ•°æ®
âœ… è·å–ç»“æ„åŒ–çš„JSONæ•°æ®
âœ… é›†æˆåˆ°æ‚¨çš„åº”ç”¨ä¸­

## ğŸ†˜ è·å–å¸®åŠ©

å¦‚æœé‡åˆ°é—®é¢˜ï¼š

1. **æŸ¥çœ‹æ–‡æ¡£**
   - [é…ç½®æŒ‡å—](./QWEN_SETUP.md)
   - [ä½¿ç”¨ç¤ºä¾‹](./QWEN_USAGE_EXAMPLES.md)
   - [å¿«é€Ÿå‚è€ƒ](./QWEN_QUICK_REFERENCE.md)

2. **è¿è¡Œè¯Šæ–­**
   ```bash
   python test_qwen_api.py
   ```

3. **æ£€æŸ¥æ—¥å¿—**
   ```bash
   tail -f logs/django.log
   ```

4. **æŸ¥çœ‹é˜¿é‡Œäº‘æ§åˆ¶å°**
   - æ£€æŸ¥APIè°ƒç”¨è®°å½•
   - æŸ¥çœ‹é…é¢ä½¿ç”¨æƒ…å†µ
   - ç¡®è®¤è´¦æˆ·ä½™é¢

## ğŸ“Š ç›‘æ§ä½¿ç”¨æƒ…å†µ

### æŸ¥çœ‹APIè°ƒç”¨ç»Ÿè®¡

ç™»å½• [é˜¿é‡Œäº‘DashScopeæ§åˆ¶å°](https://dashscope.console.aliyun.com/)ï¼š

- æŸ¥çœ‹ä»Šæ—¥è°ƒç”¨æ¬¡æ•°
- ç›‘æ§æˆåŠŸç‡
- æ£€æŸ¥è´¹ç”¨æ¶ˆè€—

### æœ¬åœ°ç»Ÿè®¡

æŸ¥çœ‹æ•°æ®åº“ä¸­çš„å¤„ç†è®°å½•ï¼š

```bash
python manage.py shell

>>> from api.models import PlanDocument
>>> PlanDocument.objects.count()  # æ€»æ–‡æ¡£æ•°
>>> PlanDocument.objects.filter(status='completed').count()  # æˆåŠŸæ•°
>>> PlanDocument.objects.filter(status='failed').count()  # å¤±è´¥æ•°
```

## ğŸ” å®‰å…¨æé†’

1. **ä¿æŠ¤APIå¯†é’¥**
   - ä¸è¦æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶
   - å®šæœŸè½®æ¢å¯†é’¥
   - é™åˆ¶è®¿é—®æƒé™

2. **æ–‡ä»¶å®‰å…¨**
   - éªŒè¯ä¸Šä¼ æ–‡ä»¶ç±»å‹
   - é™åˆ¶æ–‡ä»¶å¤§å°
   - å®šæœŸæ¸…ç†æ—§æ–‡ä»¶

3. **æ•°æ®éšç§**
   - ä¸è¦åœ¨æ—¥å¿—ä¸­è®°å½•æ•æ„Ÿä¿¡æ¯
   - å®æ–½è®¿é—®æ§åˆ¶
   - éµå®ˆæ•°æ®ä¿æŠ¤æ³•è§„

## ğŸ“ˆ åç»­è®¡åˆ’

- [ ] å®ŒæˆåŸºç¡€é…ç½®å’Œæµ‹è¯•
- [ ] é›†æˆåˆ°å‰ç«¯ç•Œé¢
- [ ] æ·»åŠ äººå·¥æ ¡éªŒåŠŸèƒ½
- [ ] å®æ–½æ‰¹é‡å¤„ç†
- [ ] éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ

---

**æ­å–œï¼** æ‚¨å·²ç»æˆåŠŸé…ç½®äº†é˜¿é‡Œåƒé—®PDFè¯†åˆ«åŠŸèƒ½ã€‚å¼€å§‹æ„å»ºæ‚¨çš„åº”ç”¨å§ï¼ ğŸš€

å¦‚æœ‰ä»»ä½•é—®é¢˜ï¼Œè¯·å‚è€ƒè¯¦ç»†æ–‡æ¡£æˆ–æŸ¥çœ‹é¡¹ç›®ä¸­çš„å…¶ä»–æŒ‡å—ã€‚
